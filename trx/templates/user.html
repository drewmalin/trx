{% extends "base.html" %}
{% block body %}
	<!-- If the user is selected, allow them to switch users ("logout") -->
	{% if current_user.is_authenticated() %}

     <script>
    $(function() {
        function split( val ) {
            return val.split( /,\s*/ );
        }
        $( "#exerciseDropdown" )
            // don't navigate away from the field on tab when selecting an item
            .bind( "keydown", function( event ) {
            if ( event.keyCode === $.ui.keyCode.TAB &&
                $( this ).data( "ui-autocomplete" ).menu.active ) {
                event.preventDefault();
            }
        })
        .autocomplete({
            minLength: 0,
            source: '/exercisedropdown/',
            focus: function() {
                return false;
            }
        });
        $( "#userDropdown" )
            // don't navigate away from the field on tab when selecting an item
            .bind( "keydown", function( event ) {
            if ( event.keyCode === $.ui.keyCode.TAB &&
                $( this ).data( "ui-autocomplete" ).menu.active ) {
                event.preventDefault();
            }
        })
        .autocomplete({
            minLength: 0,
            source: '/userdropdown/',
            focus: function() {
                return false;
            },
            select: function( event, ui ) {

                // Save text values for prompt
                var result = "";
                var terms = split( this.value );
                if (terms[0] == "") {
                    terms.splice(0, 1);
                }
                terms.push( ui.item.label );
                result = terms.join(", ");
                $("#userDropdown").val(result);

                // Save ids for server request
                var ids = split($("#hiddenUserIDs").val())
                if (ids[0] == "") {
                    ids.splice(0, 1);
                }
                ids.push(ui.item.value);
                $("#hiddenUserIDs").val(ids);
                return false;
            }
        });
    });
    </script>
		<ul class="nav nav-tabs">
            <li class="dropdown active">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Home<b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li><a href="{{ url_for('calendar') }}">Calendar</a></li>
                    <li><a href="{{ url_for('index') }}">Chart</a></li>
                    <li><a href="{{ url_for('weighin') }}">Weigh-in</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Settings</a></li>
                </ul>
            </li>
            <li>
                <a href="#">Gym</a>
            </li>
	        <li>
	            <a href="#">User Search</a>
	        </li>
        </ul>
        {% for workout in workouts %}
        {% else %}
            <p>No workouts yet!
        {% endfor %}
        <dt>
        	<h4>View workout history</h4>
        	
            <dd><br>
            <dt>Select a workout below:
            <dd><div class="ui-widget">
                <input id="exerciseDropdown" size="50" />
            </div>
            <dt>Compare your results with other users:
            <dd><div class="ui-widget">
                <input id="userDropdown" size="50"/>
            </div>
            <input type="hidden" id="hiddenUserIDs"/>
            <dd><br>

            <dd><button id="refresh_button">Refresh Chart</button>

        </dt>
        <div id="chart" style="min-width: 400px; height: 400px; margin: 0 auto" uid="{{current_user.id}}"></div>
        <h4><a href="{{url_for('workout')}}">Record Workout</a></h4><br>
    <!-- If no user is selected, allow them to "login" -->
	{% else %}
		<h2>Login</h2>
		<form action="{{url_for('index')}}" method="post">
			<dt>Username: 
	    	<dd><input type=text name=username /><br>
	    	<dt>Password: 
            <dd><input type=password name=password /><br>
	      	<dd><input type=submit value=Go />
		</form>
		<p>New user? Click <a href="{{ url_for('new_user') }}">here</a>!
    {% endif %}
{% endblock %}
